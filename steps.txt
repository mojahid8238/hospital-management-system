4# Steps to Add Video Calling with Jitsi

This document outlines the steps to integrate a free and easy-to-use video calling feature into the hospital management system using Jitsi.

## 1. What is Jitsi?

Jitsi is a set of open-source projects that allows you to easily build and deploy secure video conferencing solutions. We will use the Jitsi Meet IFrame API, which is the simplest way to embed a Jitsi video call into a web page.

## 2. Integration Steps

The integration is done entirely on the frontend (client-side) for a basic setup.

### Step 2.1: Add a placeholder for the video call

In the file where you want to show the video call (e.g., `messaging/messaging.php` or a new `video_call.php` page), add a `div` element that will contain the video conference.

```html
<div id="jitsi-container" style="width: 800px; height: 600px;"></div>
```

You can also add a "Start Video Call" button to trigger the video call.

```html
<button id="startVideoCallBtn">Start Video Call</button>
```

### Step 2.2: Include the Jitsi IFrame API script

Include the Jitsi IFrame API script in your HTML file. It's best to put this at the bottom of your `<body>` tag.

```html
<script src="https://meet.jit.si/external_api.js"></script>
```

### Step 2.3: Write the JavaScript to initialize the video call

Add a script to your page to initialize the Jitsi video call when the "Start Video Call" button is clicked.

```javascript
document.getElementById('startVideoCallBtn').addEventListener('click', () => {
    const domain = 'meet.jit.si';
    // Generate a unique room name for each call.
    // For example, you can use the appointment ID.
    const roomName = 'hms-appointment-' + appointmentId; // Make sure appointmentId is available in your JS
    const options = {
        roomName: roomName,
        width: 800,
        height: 600,
        parentNode: document.querySelector('#jitsi-container'),
        userInfo: {
            displayName: '<?php echo $_SESSION['name']; ?>' // Pass the user's name
        }
    };
    const api = new JitsiMeetExternalAPI(domain, options);

    // You can also add event listeners to the Jitsi API
    api.addEventListener('videoConferenceJoined', () => {
        console.log('Local user joined');
    });
});
```

## 3. Where to put the video call feature

A good place to add the video call feature would be in the `messaging/messaging.php` page. You could add a video call button in the chat header. When clicked, it could open the video call in a modal window or navigate to a dedicated video call page.

For online appointments, you could have a "Join Call" button that directly opens the video call interface.

## 4. Example Implementation

Here is an example of how you could modify `messaging/messaging.php` to add a video call button.

In `messaging/messaging.php`, add this to the chat header:
```php
<div class="chat-header" id="chatHeader">
    <!-- existing content -->
    <button id="startVideoCallBtn" style="margin-left: auto; background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 5px;">
        <i class="fas fa-video"></i> Video Call
    </button>
</div>
```

Then, add the Jitsi container and the scripts at the bottom of the `<body>`:
```html
<!-- at the bottom of the body -->
<div id="jitsi-container" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1001;"></div>
<script src="https://meet.jit.si/external_api.js"></script>
<script>
    // ... (the javascript from step 2.3)
    // You would need to get the appointmentId for the room name.
</script>
```

This is a basic outline. You can customize the appearance and functionality further based on your needs.
